---
title: "時系列分析勉強メモ"
emoji: "😸"
type: "tech"
topics: []
published: false
---

# 時系列データとは
時系列データ

$$
\{y_t\}_{t=1}^T = \{y_1, y_2, \ldots, y_T\}
$$
とは、時間とともに観測されたデータである．
- 毎年の企業利益
- 毎日の株価
- 毎四半期のGDP
## 主な特徴
- 観測される順番（$t=1,\ldots,T$）に意味がある
- 観測値の間に相関がある
- 時点 $t$ に観測できるデータは一つだけ
## 時系列データの確率過程
> 時系列データは確率的に決定される

データの背後には母集団である確率過程

$$ \{y_t\}_{-\infty}^{\infty}=\{\ldots, y_{-1}, y_{0}, y_{1}, \ldots\}$$
が存在し，そこからデータが生成されたと考える．つまり，各時点 $t$ に観測されるデータ $y_t$ はある確率分布に従っており，観測データはその実現値であると考える．

一般に，$y_t$ はそれぞれ異なる確率分布に従うと想定される．言い換えると，データを生成する確率分布は時間変化しており，平均や分散は時間に依存する．

## 時系列データの統計量
$y_t$ の確率密度関数を $f(y_t)$ とする．
:::message alert
ここはあくまでも実際のデータ $y_t$（一つしかない）から計算できる量ではなく，$y_t$ を確率変数 $Y_t$ として扱った時の話？
:::
### 期待値
$$
\mu_t = E[y_t] = \int_{-\infty}^{\infty} y_t f(y_t) dy_t
$$
時点 $t$ の観測値が平均的にとる値を表す．

### 分散
$$
\sigma_t^2 = Var[y_t] = E\left[\left(y_t - E[y_t]\right)^2\right]
= \int_{-\infty}^{\infty} (y_t - \mu_t)^2 f(y_t) dy_t
$$
時点 $t$ の観測値のばらつきの程度を表す．

### $k$ 次自己共分散
$$
\gamma_{kt} = Cov[y_{t}, y_{t-k}]
= E\left[ \left(y_t - E[y_t]\right)\left(y_{t-k} - E[y_{t-k}]\right) \right]
$$
特に、$k=0$ の時 $\gamma_{0t} = \sigma_t^2$ が成立する．
- $k$ 時点離れたデータ間の関係を表す
- $k$ 次自己共分散が正（負）の時，$k$ 時点離れた二つのデータはそれぞれ平均を基準にして同じ向きに（逆向きに）動く傾向がある
- $k$ 次自己共分散を $k$ の関数とみなしたものを**自己共分散関数**という

### $k$ 次自己相関
$$
\rho_{kt} = Corr[y_{t}, y_{t-k}] 
= \frac{Cov[y_{t}, y_{t-k}]}{\sqrt{Var[y_t]Var[y_{t-k}]}}
= \frac{\gamma_{kt}}{\sqrt{\sigma_t^2\sigma_{t-k}^2}}
= \frac{\gamma_{kt}}{\sqrt{\gamma_{0t}\gamma_{0t-k}}}
$$
特に、$k=0$ の時は，

$$
\rho_{kt} = \frac{\sigma_t^2}{\sqrt{\sigma_t^2\sigma_t^2}} = 1
$$
である．
- $\forall k \ge 1,~~\|\rho_{kt}\| \le 1$
- $k$ 次自己相関を $k$ の関数とみなしたものを**自己相関関数**という
- 自己相関関数をグラフにしたものを**コレログラム**という

## 標本から計算する統計量
:::message
各時点 $t$ で観測できるデータは一つだけという制約の下，どのように統計量を計算するか．
:::
### 標本平均
観測値の合計を標本数 $T$ で割ったもの：

$$\bar{y} = \frac{1}{T}\sum_{t=1}^T y_t$$

### 標本分散
観測値の標本平均からのズレ（偏差）の自乗和を標本数 $T$ で割ったもの：

$$\hat{\gamma_0} = \frac{1}{T}\sum_{t=1}^T(y_{t} - \bar{y})^2$$

### $k$ 次標本自己共分散
現時点のデータ $y_t$ と $k$ 時点離れたデータ $y_{t-k}$ において，それぞれの偏差の積をすべての $t$ について足し合わせて標本数 $T$ で割ったもの：

$$\hat{\gamma_k} = \frac{1}{T}\sum_{t=k+1}^T(y_{t-k} - \bar{y})(y_{t} - \bar{y})$$

### $k$ 次標本自己相関
:::message alert
これ定常性の仮定の下での話？
:::

$$\hat{\rho}_k = \frac{\hat{\gamma_k}}{\hat{\gamma_0}}$$

### コレログラム
$k$ 次標本自己相関を $k$ の関数とみなす．

$$\hat{\rho}_k~~~~(k = 1,\ldots, K)$$

# 時系列分析の目的
> 観測された時系列データ $\{y_t\}_{t=1}^T$ の挙動を説明できるモデルの構築

データの特徴上，時点 $t$ に観測できるデータは一つだけなので，一つの実現値から背後にある確率分布を推定するという困難が伴う．そこで，確率過程に対して何らかの構造（時系列モデル）を仮定して，確率過程の推定や予測を行う．

# 定常性の仮定
時系列データを分析する際，定常性 (stationarity) を仮定する．定常性には２種類ある．
## 強定常性 (strict stationarity)
一般に，$y_t$ はそれぞれ異なる確率分布に従うと想定されるが，任意の $t\in\{1,\ldots,T\}$ に対して $y_t$ が全く同一の分布に従うとき，時系列データ $\{y_t\}_{t=1}^T$ は**強定常性**を持つ．強定常性を持つ時系列データは，あたかも同時点で観測されたデータのように扱うことができる．

### iid 系列
:::message alert
iid 系列は強定常仮定を満たすか？
:::

## 弱定常性 (weak stationarity)
**弱定常性**あるいは**共分散定常性** (covariance stationarity) とは，任意の $t,k$ に対して，

$$
\begin{align*}
E[y_t] &= \mu \\
Var[y_t] &= \sigma^2 = \gamma_{0t} = \gamma_{0} \\
Cov[y_{t}, y_{t-k}] &= \gamma_{kt} = \gamma_{k}
\end{align*}
$$
が成り立つという性質である．時点 $t$ の観測値 $y_t$ の期待値 $\mu_t$ と $k$ 次自己共分散 $\gamma_{kt}$ が時間 $t$ に依存しないということ．弱定常では相関構造が時点 $t$ に依存しないという点がポイント．

:::message
単に定常性という場合，弱定常性を指す場合が多い．
:::
:::message alert
定常性の仮定は，条件付き分布までも定常（時間に関して一定）であることを要求しない．定常性の仮定の下でも，条件付き期待値や条件付き分散が時間に依存することはある．
例）線形モデル $y_t = \beta x_t + \varepsilon_t$ において，

$$
\begin{cases}
E[y_t | x_t] = \beta x_t \\
E[\varepsilon_t | x_t] = 0
\end{cases}
$$
であり，$E[y_t | x_t]$ は時点 $t$ に依存する．
:::

### （弱）定常性で成り立つ性質
1. $k$ 次自己共分散は時間に依存しないので， $k$ 時点前と $k$ 時点後における現在のデータ $y_t$ との自己共分散は等しい：

$$
\gamma_{kt} = \gamma_{k} = \gamma_{-k}
$$

2. 相関構造が時間に依存しないので， $k$ 時点前と $k$ 時点後における現在のデータ $y_t$ との相関は等しい．自己相関係数は，

$$
\rho_{kt} = \frac{\gamma_{kt}}{\sqrt{\gamma_{0t}\gamma_{0t-k}}} = 
\frac{\gamma_{k}}{\sqrt{\gamma_{0}\gamma_{0}}} = 
\frac{\gamma_{k}}{\gamma_{0}} = 
\rho_{k}.
$$
よって，

$$
\rho_{kt} = \rho_{k} = \rho_{-k}
$$